/*
 * ours_2step_topmed.config
 *
 * Our Pipeline Variant F: 2-Step Imputation with MagicalRsq-X
 *
 * Pipeline Flow:
 *   Module 1: Union merge within platform → Minimal QC → Prep for imputation
 *   Module 2: Submit to TOPMed (1st imputation)
 *   Module 3: Download results
 *   Module 4: Intersect merge across platforms
 *   Module 5: Re-imputation (2nd imputation to recover intersect-lost variants)
 *   Module 6: MagicalRsq-X filter → Thorough QC (HWE skip, het, relatedness)
 *   Module 7: GRAF-anc ancestry classification
 *
 * Key Settings:
 *   - skip_reimputation = false (full 2-step imputation)
 *   - skip_hwe = true (for admixed populations)
 *   - use_magicalrsq = true
 *   - run_topmed = true
 *   - run_anvil = false
 *
 * This is the FULL pipeline as designed, maximizing variant recovery.
 */

params {
    // =========================================================================
    // BENCHMARK IDENTIFIER
    // =========================================================================
    benchmark_name = 'ours_2step_topmed'
    benchmark_description = 'Our pipeline with 2-step imputation + TOPMed + MagicalRsq-X (FULL)'

    // =========================================================================
    // IMPUTATION SETTINGS
    // =========================================================================

    // Only TOPMed imputation
    run_topmed = true
    run_anvil = false

    // ENABLE re-imputation (full 2-step)
    skip_reimputation = false

    // =========================================================================
    // QC SETTINGS (Thorough QC AFTER imputation)
    // =========================================================================

    // Minimal QC before imputation (Module 1)
    pre_imputation_maf = 0.0      // Don't filter rare variants before imputation
    pre_imputation_hwe = false    // Don't filter HWE before imputation

    // Thorough QC after imputation (Module 6)
    skip_hwe = true               // Skip HWE for admixed populations
    hwe_pvalue = 1e-6
    het_sd_threshold = 3
    use_genesis = true
    kinship_threshold = 0.177

    // =========================================================================
    // MAGICALRSQ-X SETTINGS
    // =========================================================================

    use_magicalrsq = true
    magicalrsq_threshold = 0.3
    primary_ancestry = 'EUR'

    // =========================================================================
    // OUTPUT SETTINGS
    // =========================================================================

    outdir = 'benchmarking/results/ours_2step_topmed'

    trace_report = true
    timeline_report = true
    dag_report = true
}

process {
    beforeScript = 'echo "START $(date +%s)" >> ${task.workDir}/timing.log'
    afterScript = 'echo "END $(date +%s)" >> ${task.workDir}/timing.log'
}
