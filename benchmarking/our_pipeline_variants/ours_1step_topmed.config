/*
 * ours_1step_topmed.config
 *
 * Our Pipeline Variant E: 1-Step Imputation with MagicalRsq-X
 *
 * Pipeline Flow:
 *   Module 1: Union merge within platform → Minimal QC → Prep for imputation
 *   Module 2: Submit to TOPMed (single imputation)
 *   Module 3: Download results
 *   Module 4: Intersect merge across platforms
 *   Module 5: SKIP (no re-imputation)
 *   Module 6: MagicalRsq-X filter → Thorough QC (HWE skip, het, relatedness)
 *   Module 7: GRAF-anc ancestry classification
 *
 * Key Settings:
 *   - skip_reimputation = true (only 1 imputation step)
 *   - skip_hwe = true (for admixed populations)
 *   - use_magicalrsq = true
 *   - run_topmed = true
 *   - run_anvil = false
 */

params {
    // =========================================================================
    // BENCHMARK IDENTIFIER
    // =========================================================================
    benchmark_name = 'ours_1step_topmed'
    benchmark_description = 'Our pipeline with 1-step imputation + TOPMed + MagicalRsq-X'

    // =========================================================================
    // IMPUTATION SETTINGS
    // =========================================================================

    // Only TOPMed imputation
    run_topmed = true
    run_anvil = false

    // SKIP re-imputation (1-step only)
    skip_reimputation = true

    // =========================================================================
    // QC SETTINGS (Thorough QC AFTER imputation)
    // =========================================================================

    // Minimal QC before imputation (Module 1)
    // - Only basic call rate and biallelic filters
    // - NO MAF filter before imputation
    // - NO HWE filter before imputation
    pre_imputation_maf = 0.0      // Don't filter rare variants before imputation
    pre_imputation_hwe = false    // Don't filter HWE before imputation

    // Thorough QC after imputation (Module 6)
    skip_hwe = true               // Skip HWE for admixed populations
    hwe_pvalue = 1e-6             // (only used if skip_hwe = false)
    het_sd_threshold = 3          // Heterozygosity outliers
    use_genesis = true            // Use GENESIS PCRelate for relatedness
    kinship_threshold = 0.177     // 1st-degree relatedness

    // =========================================================================
    // MAGICALRSQ-X SETTINGS
    // =========================================================================

    use_magicalrsq = true
    magicalrsq_threshold = 0.3    // MagicalRsq-X calibrated threshold
    primary_ancestry = 'EUR'      // Default model (auto-detected per sample)

    // =========================================================================
    // OUTPUT SETTINGS
    // =========================================================================

    outdir = 'benchmarking/results/ours_1step_topmed'

    // Enable detailed logging for benchmarking
    trace_report = true
    timeline_report = true
    dag_report = true
}

// Process-specific settings for timing measurement
process {
    // Add timing to all processes
    beforeScript = 'echo "START $(date +%s)" >> ${task.workDir}/timing.log'
    afterScript = 'echo "END $(date +%s)" >> ${task.workDir}/timing.log'
}
